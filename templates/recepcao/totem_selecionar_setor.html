{% extends 'base.html' %}
{% block title %}Selecione o Setor/Gabinete{% endblock %}
{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">Selecione o Setor ou Gabinete para registrar a visita</h2>
  {% if visitante %}
  <div class="card mb-4 shadow-lg position-relative" style="border-left: 8px solid #007bff; background: linear-gradient(90deg, #fff 80%, #e9f1fb 100%);">
    <div class="row g-0 align-items-center">
      <div class="col-md-3 text-center p-3">
        {% if visitante.foto %}
          <div class="visitante-foto-oval mx-auto">
            <img src="{{ visitante.foto.url }}" alt="Foto do visitante" class="img-fluid" style="width:120px;height:150px;object-fit:cover;">
          </div>
        {% else %}
          <div class="visitante-foto-oval mx-auto bg-secondary text-white d-flex align-items-center justify-content-center" style="width:120px;height:150px;">Sem Foto</div>
        {% endif %}
      </div>
      <div class="col-md-1 d-none d-md-block">
        <div style="border-left:2px solid #eee;height:100px;"></div>
      </div>
      <div class="col-md-8 p-3">
        <h5 class="mb-3 text-primary fw-bold"><i class="fas fa-user me-2 text-info"></i>{{ visitante.nome_completo }}</h5>
        <p class="mb-2"><span class="fw-bold text-secondary"><i class="fas fa-id-card me-2 text-warning"></i>CPF:</span> <span class="text-dark">{{ visitante.CPF }}</span></p>
        <p class="mb-2"><span class="fw-bold text-secondary"><i class="fas fa-phone me-2 text-success"></i>Telefone:</span> <span class="text-dark">{{ visitante.telefone }}</span></p>
        <p class="mb-2"><span class="fw-bold text-secondary"><i class="fas fa-envelope me-2 text-danger"></i>Email:</span> <span class="text-dark">{{ visitante.email }}</span></p>
        <p class="mb-2"><span class="fw-bold text-secondary"><i class="fas fa-building me-2 text-primary"></i>Empresa:</span> <span class="text-dark">{{ visitante.empresa }}</span></p>
      </div>
    </div>
  </div>
  {% endif %}
  <form method="post">
    {% csrf_token %}
    <div class="mb-3">
      <label for="tipo" class="form-label">Tipo</label>
      <select id="tipo" name="tipo" class="form-select">
        <option value="">Selecione o tipo...</option>
        <option value="departamento">Setor</option>
        <option value="gabinete">Gabinete</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="setor" class="form-label">Setor/Gabinete</label>
      <select id="setor" name="setor" class="form-select">
        <option value="">Selecione o setor ou gabinete...</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary">Registrar Visita</button>
  </form>
</div>
<style>
.visitante-foto-oval {
  width: 120px;
  height: 150px;
  border-radius: 50% / 45%;
  overflow: hidden;
  border: 4px solid #007bff;
  box-shadow: 0 4px 16px 0 rgba(0,123,255,0.10), 0 2px 8px 0 rgba(0,0,0,0.08);
  background: #f8fafc;
  display: flex;
  align-items: center;
  justify-content: center;
}
.card {
  background: linear-gradient(90deg, #fff 80%, #e9f1fb 100%) !important;
  border-radius: 1.5rem !important;
  border: none;
}
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tipoSelect = document.getElementById('tipo');
  const setorSelect = document.getElementById('setor');

  tipoSelect.addEventListener('change', function() {
    const tipo = this.value;
    setorSelect.innerHTML = '<option value="">Carregando...</option>';
    if (tipo) {
      fetch(`/recepcao/setores/buscar/?tipo=${tipo}`)
        .then(resp => resp.json())
        .then(data => {
          setorSelect.innerHTML = '<option value="">Selecione...</option>';
          if (data.setores && data.setores.length > 0) {
            data.setores.forEach(function(setor) {
              let nome = setor.tipo === 'gabinete' ? `Gabinete do Vereador ${setor.nome_vereador} (${setor.localizacao})` : `${setor.nome_local} (${setor.localizacao})`;
              setorSelect.innerHTML += `<option value="${setor.id}">${nome}</option>`;
            });
          } else {
            setorSelect.innerHTML = '<option value="">Nenhum encontrado</option>';
          }
        });
    } else {
      setorSelect.innerHTML = '<option value="">Selecione o setor ou gabinete...</option>';
    }
  });
});
</script>
{% endblock %} 