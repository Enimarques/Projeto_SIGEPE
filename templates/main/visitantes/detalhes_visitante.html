{% extends 'base.html' %}
{% load static %}

{% block title %}Detalhes do Visitante - URUTAU{% endblock %}

{% block content %}
<div class="container">
    <div class="row align-items-center mb-4">
        <div class="col-md-8">
            <h1 class="display-5 mb-0">Detalhes do Visitante</h1>
            <p class="lead text-muted">Informações completas e histórico de visitas</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{% url 'main:lista_visitantes' %}" class="btn btn-outline-primary">
                <i class="fas fa-arrow-left me-2"></i>Voltar para Lista
            </a>
        </div>
    </div>

    <!-- Informações do Visitante -->
    <div class="card mb-4">
        <div class="card-body p-4">
            <div class="row">
                <div class="col-md-4 text-center mb-4">
                    {% if visitante.foto %}
                    <img src="{{ visitante.foto.url }}" alt="{{ visitante.nome_completo }}" 
                         class="rounded-circle mb-3" style="width: 200px; height: 200px; object-fit: cover;
                         border: 3px solid var(--light-color); box-shadow: 0 2px 4px rgba(0,0,0,.1);">
                    {% else %}
                    <div class="rounded-circle mb-3 mx-auto d-flex align-items-center justify-content-center bg-light"
                         style="width: 200px; height: 200px; border: 3px solid var(--light-color);">
                        <i class="fas fa-user-circle fa-6x text-muted"></i>
                    </div>
                    {% endif %}
                    <h3 class="mb-2">{{ visitante.nome_completo }}</h3>
                    {% if visitante.empresa %}
                    <p class="text-muted mb-0">
                        <i class="fas fa-building me-2"></i>{{ visitante.empresa }}
                    </p>
                    {% endif %}
                </div>
                <div class="col-md-8">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted">
                                    <i class="fas fa-id-card me-2"></i>Documento
                                </label>
                                <p class="h5">{{ visitante.documento }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted">
                                    <i class="fas fa-phone me-2"></i>Telefone
                                </label>
                                <p class="h5">{{ visitante.telefone }}</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label text-muted">
                                    <i class="fas fa-envelope me-2"></i>Email
                                </label>
                                <p class="h5">{{ visitante.email|default:"Não informado" }}</p>
                            </div>
                            <div class="mb-3">
                                <label class="form-label text-muted">
                                    <i class="fas fa-calendar me-2"></i>Cadastrado em
                                </label>
                                <p class="h5">{{ visitante.data_cadastro|date:"d/m/Y" }}</p>
                            </div>
                        </div>
                        {% if visitante.observacoes %}
                        <div class="col-12">
                            <div class="mb-3">
                                <label class="form-label text-muted">
                                    <i class="fas fa-comment me-2"></i>Observações
                                </label>
                                <p class="h5">{{ visitante.observacoes }}</p>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        <div class="card-footer bg-white border-top-0 text-end">
            <a href="{% url 'main:registro_visitas' %}?visitante={{ visitante.id }}" class="btn btn-primary">
                <i class="fas fa-clipboard-list me-2"></i>Registrar Nova Visita
            </a>
        </div>
    </div>

    <!-- Histórico de Visitas -->
    <div class="card">
        <div class="card-header bg-white">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-history me-2"></i>Histórico de Visitas
                </h5>
                <span class="badge bg-primary">Total: {{ visitas.count }}</span>
            </div>
        </div>
        <div class="card-body p-0">
            {% if visitas %}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Data</th>
                            <th>Objetivo</th>
                            <th>Veículo</th>
                            <th>Status</th>
                            <th>Duração</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for visita in visitas %}
                        <tr>
                            <td>
                                <div>{{ visita.data_entrada|date:"d/m/Y" }}</div>
                                <small class="text-muted">{{ visita.data_entrada|time:"H:i" }}</small>
                            </td>
                            <td>{{ visita.get_objetivo_display }}</td>
                            <td>
                                {% if visita.veiculo %}
                                <a href="{% url 'veiculos:detalhes_veiculo' placa=visita.veiculo.placa %}" class="text-decoration-none">
                                    {{ visita.veiculo.placa }} - {{ visita.veiculo.modelo }}
                                </a>
                                {% else %}
                                <span class="text-muted">Sem veículo</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if visita.status == 'em_andamento' %}
                                <span class="badge bg-success">Em Andamento</span>
                                {% else %}
                                <span class="badge bg-secondary">Finalizada</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if visita.status == 'finalizada' %}
                                {{ visita.duracao }}
                                {% else %}
                                <span class="text-muted">Em andamento</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-5">
                <i class="fas fa-clipboard fa-3x text-muted mb-3"></i>
                <h5 class="text-muted">Nenhuma visita registrada</h5>
                <p class="mb-3">Registre a primeira visita deste visitante</p>
                <a href="{% url 'main:registro_visitas' %}?visitante={{ visitante.id }}" class="btn btn-primary">
                    <i class="fas fa-clipboard-list me-2"></i>Registrar Visita
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    .badge {
        font-size: 0.9rem;
        padding: 0.5rem 1rem;
    }

    .table th {
        background-color: var(--light-color);
        border: none;
    }

    .table td {
        vertical-align: middle;
    }

    .form-label {
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
    }

    .h5 {
        margin-bottom: 0;
    }
</style>
{% endblock %}
