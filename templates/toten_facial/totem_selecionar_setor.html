{% extends 'base.html' %}
{% load static %}

{% block title %}Selecione o Setor/Gabinete{% endblock %}

{% block extra_css %}
<style>
body, html {
  min-height: 100vh;
  background: linear-gradient(135deg, #4f8cff 0%, #7b2ff2 100%);
  font-size: 18px;
}
.totem-card {
  max-width: 480px;
  width: 98vw;
  margin: 2rem auto;
  border-radius: 2rem;
  box-shadow: 0 8px 32px rgba(44, 62, 80, 0.15);
  padding: 2rem 1.5rem;
  background: #fff;
  display: flex;
  flex-direction: column;
  align-items: center;
}
input, select, button, textarea {
  font-size: 1.1rem;
  min-height: 48px;
  border-radius: 1rem;
}
button, .main-action-btn {
  min-width: 180px;
  min-height: 56px;
  font-size: 1.2rem;
  border-radius: 2rem;
}
@media (max-width: 900px) {
  .totem-card { max-width: 98vw; }
}
@media (max-width: 600px) {
  .totem-card { padding: 1rem 0.5rem; }
}
</style>
{% endblock %}

{% block content %}
<div class="totem-card">
  <h2 class="mb-4 text-primary fw-bold text-center" style="font-size:2rem;">Selecione o Setor ou Gabinete para registrar a visita</h2>
  {% if visitante %}
  <div class="card mb-4 shadow-lg w-100" style="border-left: 8px solid #007bff; background: linear-gradient(90deg, #fff 80%, #e9f1fb 100%); border-radius:1.5rem;">
    <div class="row g-0 align-items-center">
      <div class="col-12 text-center p-3">
        {% if visitante.foto %}
          <div style="width:120px;height:150px;margin:0 auto 1rem auto;overflow:hidden;border-radius:50%/45%;border:4px solid #007bff;box-shadow:0 4px 16px 0 rgba(0,123,255,0.10),0 2px 8px 0 rgba(0,0,0,0.08);background:#f8fafc;display:flex;align-items:center;justify-content:center;">
            <img src="{{ visitante.foto.url }}" alt="Foto do visitante" class="img-fluid" style="width:120px;height:150px;object-fit:cover;">
          </div>
        {% else %}
          <div style="width:120px;height:150px;margin:0 auto 1rem auto;overflow:hidden;border-radius:50%/45%;border:4px solid #007bff;box-shadow:0 4px 16px 0 rgba(0,123,255,0.10),0 2px 8px 0 rgba(0,0,0,0.08);background:#f8fafc;display:flex;align-items:center;justify-content:center;color:#888;">Sem Foto</div>
        {% endif %}
        <h5 class="mb-2 text-primary fw-bold"><i class="fas fa-user me-2 text-info"></i>{{ visitante.nome_completo }}</h5>
        <p class="mb-1"><span class="fw-bold text-secondary"><i class="fas fa-id-card me-2 text-warning"></i>CPF:</span> <span class="text-dark">{{ visitante.CPF }}</span></p>
        <p class="mb-1"><span class="fw-bold text-secondary"><i class="fas fa-phone me-2 text-success"></i>Telefone:</span> <span class="text-dark">{{ visitante.telefone }}</span></p>
        <p class="mb-1"><span class="fw-bold text-secondary"><i class="fas fa-envelope me-2 text-danger"></i>Email:</span> <span class="text-dark">{{ visitante.email }}</span></p>
        <p class="mb-1"><span class="fw-bold text-secondary"><i class="fas fa-building me-2 text-primary"></i>Empresa:</span> <span class="text-dark">{{ visitante.empresa }}</span></p>
      </div>
    </div>
  </div>
  {% endif %}
  <form method="post" class="w-100">
    {% csrf_token %}
    <div class="mb-3">
      <label for="tipo" class="form-label">Tipo</label>
      <select id="tipo" name="tipo" class="form-select">
        <option value="">Selecione o tipo...</option>
        <option value="departamento">Setor</option>
        <option value="gabinete">Gabinete</option>
      </select>
    </div>
    <div class="mb-3">
      <label for="setor" class="form-label">Setor/Gabinete</label>
      <select id="setor" name="setor" class="form-select">
        <option value="">Selecione o setor ou gabinete...</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary w-100" style="font-size:1.2rem;min-height:56px;">Registrar Visita</button>
  </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const tipoSelect = document.getElementById('tipo');
  const setorSelect = document.getElementById('setor');

  tipoSelect.addEventListener('change', function() {
    const tipo = this.value;
    setorSelect.innerHTML = '<option value="">Carregando...</option>';
    if (tipo) {
      fetch(`/recepcao/setores/buscar/?tipo=${tipo}`)
        .then(resp => resp.json())
        .then(data => {
          setorSelect.innerHTML = '<option value="">Selecione...</option>';
          if (data.setores && data.setores.length > 0) {
            data.setores.forEach(function(setor) {
              let nome = setor.tipo === 'gabinete' ? `Gabinete do Vereador ${setor.nome_vereador} (${setor.localizacao})` : `${setor.nome_local} (${setor.localizacao})`;
              setorSelect.innerHTML += `<option value="${setor.id}">${nome}</option>`;
            });
          } else {
            setorSelect.innerHTML = '<option value="">Nenhum encontrado</option>';
          }
        });
    } else {
      setorSelect.innerHTML = '<option value="">Selecione o setor ou gabinete...</option>';
    }
  });
});
</script>
{% endblock %} 